<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acquista La Guida - La Riconquista</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      color: #222;
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
      line-height: 1.6;
    }
    h1 {
      color: #0056b3;
      text-align: center;
      margin-bottom: 2rem;
    }
    form label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
    }
    input[type=text], input[type=email] {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    button, #paypal-button-container button {
      margin-top: 1.5rem;
      background: #0056b3;
      border: none;
      color: white;
      font-weight: 700;
      padding: 0.8rem;
      font-size: 1.1rem;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s ease;
    }
    button:hover, #paypal-button-container button:hover {
      background: #003d80;
    }
    #paypal-button-container {
      margin-top: 2rem;
      display: none;
    }
    #download-section {
      display: none;
      margin-top: 2rem;
      background: #e0ffe0;
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
    }
    #download-section a {
      font-weight: 700;
      color: #0056b3;
      text-decoration: none;
    }
    #download-section a:hover {
      text-decoration: underline;
    }
    .error {
      color: red;
      margin-top: 0.5rem;
      font-weight: 600;
    }
  </style>
</head>
<body>

  <h1>Acquista la Guida PDF "La Riconquista"</h1>

  <form id="buyerInfoForm">
    <label for="nome">Nome</label>
    <input type="text" id="nome" name="nome" required autocomplete="given-name" />
    
    <label for="cognome">Cognome</label>
    <input type="text" id="cognome" name="cognome" required autocomplete="family-name" />
    
    <label for="email">Email</label>
    <input type="email" id="email" name="email" required autocomplete="email" />
    
    <button type="submit">Procedi al Pagamento</button>
    <div id="form-error" class="error" aria-live="polite"></div>
  </form>

  <div id="paypal-button-container"></div>

  <div id="download-section" aria-live="polite">
    <h2>Grazie per l'acquisto!</h2>
    <p>Clicca sul link qui sotto per scaricare subito la guida PDF:</p>
    <a href="https://drive.google.com/uc?export=download&id=1INOnus1WjNSWaHR2_l97X9JMW-sbRRj5" target="_blank" rel="noopener noreferrer">
      Scarica il PDF "La Riconquista"
    </a>
  </div>

  <script src="https://www.paypal.com/sdk/js?client-id=TUO_CLIENT_ID&currency=EUR"></script>
  <script>
    const form = document.getElementById('buyerInfoForm');
    const paypalContainer = document.getElementById('paypal-button-container');
    const downloadSection = document.getElementById('download-section');
    const formError = document.getElementById('form-error');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      formError.textContent = '';

      const nome = form.nome.value.trim();
      const cognome = form.cognome.value.trim();
      const email = form.email.value.trim();

      if (!nome || !cognome || !email) {
        formError.textContent = 'Per favore, compila tutti i campi.';
        return;
      }
      if (!email.includes('@') || !email.includes('.')) {
        formError.textContent = 'Inserisci un indirizzo email valido.';
        return;
      }

      form.style.display = 'none';
      paypalContainer.style.display = 'block';

      if (!window.paypalButtonRendered) {
        paypal.Buttons({
          createOrder: function(data, actions) {
            return actions.order.create({
              purchase_units: [{
                amount: { value: '3.99' }
              }]
            });
          },
          onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
              paypalContainer.style.display = 'none';
              downloadSection.style.display = 'block';
              console.log('Pagamento effettuato da:', details.payer.name.given_name, details.payer.email_address);
            });
          }
        }).render('#paypal-button-container');

        window.paypalButtonRendered = true;
      }
    });
  </script>

</body>
</html>
